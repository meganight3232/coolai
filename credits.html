<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Hub - API Credits</title>
<link rel="stylesheet" href="assets/style.css">
<style>
  body{margin:0; font-family:'Roboto',sans-serif; display:flex; background:#0a0a0a; color:#eee;}
  
  /* Sidebar */
  .sidebar{
    width:240px;
    background:#111;
    height:100vh;
    position:fixed;
    left:0;
    top:0;
    padding:20px;
    box-shadow:2px 0 20px rgba(0,0,0,0.7);
    display:flex;
    flex-direction:column;
    transition: width 0.3s;
  }
  .sidebar.collapsed{width:60px;}
  .sidebar h2{color:#4a4aff; text-align:center; margin-bottom:30px;}
  .sidebar ul{list-style:none; padding:0; margin:0; flex:1;}
  .sidebar ul li{padding:12px 10px; margin-bottom:10px; cursor:pointer; border-radius:6px; transition:0.3s;}
  .sidebar ul li:hover{background:#222; color:#4a4aff;}
  .sidebar-toggle{position:absolute; bottom:20px; left:50%; transform:translateX(-50%); cursor:pointer; font-size:20px; color:#4a4aff;}

  /* Main content */
  .main-content{margin-left:240px; padding:30px; width:calc(100% - 240px); transition: margin-left 0.3s, width 0.3s;}
  .sidebar.collapsed + .main-content{margin-left:60px; width:calc(100% - 60px);}
  h3{color:#4a4aff; margin-bottom:20px;}

  .credits-container{
    background:#1b1b1b;
    padding:25px;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    max-width:600px;
    margin:auto;
  }
  .credit-item{
    display:flex;
    justify-content:space-between;
    padding:12px 16px;
    border-radius:8px;
    margin-bottom:12px;
    background:#222;
    transition:0.3s;
  }
  .credit-item:hover{background:#333;}
  .credit-item span{font-weight:500;}
  .loading{color:#4a4aff; font-weight:600;}
  .error{color:#ff4a4a; font-weight:600;}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <h2>AI Hub</h2>
  <ul>
    <li onclick="navigate('dashboard')">Home</li>
    <li onclick="navigate('images')">Images / Files</li>
    <li onclick="navigate('credits')">API Credits</li>
    <li onclick="navigate('settings')">Settings</li>
  </ul>
  <div class="sidebar-toggle" onclick="toggleSidebar()">&#9776;</div>
</div>

<div class="main-content">
  <h3>API Credit Usage</h3>
  <div class="credits-container" id="creditsContainer">
    <p class="loading">Loading API credits...</p>
  </div>
</div>

<script>
// Sidebar toggle
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('collapsed');}
function navigate(page){window.location.href = page+'.html';}

// Load API keys
const keys = JSON.parse(localStorage.getItem('userAPIKeys')||'{}');
const container = document.getElementById('creditsContainer');
container.innerHTML = '';

// OpenAI Credits
async function fetchOpenAICredits(key){
  try{
    const today = new Date().toISOString().slice(0,10);
    const response = await fetch(`https://api.openai.com/v1/dashboard/billing/usage?start_date=${today}&end_date=${today}`,{
      headers: {Authorization:`Bearer ${key}`}
    });
    const data = await response.json();
    if(data.error){
      return {error:data.error.message};
    }
    // Usage in USD today
    return {usage:data.total_usage/100};
  } catch(e){ return {error:e.message}; }
}

// Populate credits
async function loadCredits(){
  container.innerHTML = '';
  // OpenAI
  if(keys.openai){
    const div = document.createElement('div'); div.classList.add('credit-item');
    div.innerHTML = '<span>OpenAI</span><span class="loading">Loading...</span>';
    container.appendChild(div);
    const result = await fetchOpenAICredits(keys.openai);
    if(result.error){
      div.querySelector('span:last-child').textContent = result.error;
      div.querySelector('span:last-child').classList.add('error');
    } else {
      div.querySelector('span:last-child').textContent = `$${result.usage.toFixed(4)} used today`;
    }
  } else {
    const div = document.createElement('div'); div.classList.add('credit-item');
    div.innerHTML = '<span>OpenAI</span><span class="error">API key not set</span>';
    container.appendChild(div);
  }

  // Anthropic
  const divAnthropic = document.createElement('div'); divAnthropic.classList.add('credit-item');
  divAnthropic.innerHTML = '<span>Anthropic</span><span>Usage detection not implemented</span>';
  container.appendChild(divAnthropic);

  // Google Gemini
  const divGoogle = document.createElement('div'); divGoogle.classList.add('credit-item');
  divGoogle.innerHTML = '<span>Google Gemini</span><span>Usage detection not implemented</span>';
  container.appendChild(divGoogle);
}

loadCredits();
</script>

</body>
</html>
